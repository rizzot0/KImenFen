<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Agregar Nuevo Profesor</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .text-shadow {
            text-shadow: 2px 1px 2px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
<div class="w-full bg-yellow-700 p-5 flex flex-col justify-between text-yellow-400 rounded">
    <h1 class="text-2xl font-bold">Agregar Nuevo Profesor</h1>
    <form th:action="@{/administrador/profesores/guardar}" th:object="${profesor}" method="post">
        <div th:if="${error}">
            <p class="text-red-500" th:text="${error}"></p>
        </div>
        <label class="text-xl" for="nombre">Nombre:</label>
        <input class="text-black rounded px-1 focus:outline-none" type="text" id="nombre" th:field="*{nombre}" />
        <br/>
        <label class="text-xl" for="apellido">Apellido:</label>
        <input class="text-black rounded px-1 focus:outline-none" type="text" id="apellido" th:field="*{apellido}" />
        <br/>
        <label class="text-xl" for="rut">RUT:</label>
        <input class="text-black rounded px-1 focus:outline-none" type="text" id="rut" th:field="*{rut}" oninput="validarRUT(this)" />
        <span id="mensaje" class="text-sm font-bold text-shadow"></span>
        <br/>
        <label class="text-xl" for="telefono">Fono:</label>
        <input class="text-black rounded px-1 focus:outline-none" type="text" id="telefono" th:field="*{telefono}" />
        <br/>
        <button id="guardar" class="py-2 px-4 my-2 bg-green-700 hover:bg-green-800 text-2xl rounded disabled:bg-gray-400 disabled:cursor-not-allowed" type="submit">Guardar</button>
    </form>
</div>
<script>
    function validarRUT(input) {
        const rut = input.value.replace(/\./g, '').replace('-', '');
        const rutRegex = /^[0-9]{7,8}[0-9Kk]$/;

        if (!rutRegex.test(rut)) {
            input.classList.remove('border-green-500');
            input.classList.add('border-red-500');
            document.getElementById('mensaje').textContent = "Formato de RUT incorrecto";
            document.getElementById('mensaje').classList.remove('text-green-400');
            document.getElementById('mensaje').classList.add('text-red-400');
            document.getElementById('guardar').disabled = true;
            return;
        }

        const cuerpo = rut.slice(0, -1);
        const dv = rut.slice(-1).toUpperCase();
        let suma = 0;
        let multiplo = 2;

        for (let i = cuerpo.length - 1; i >= 0; i--) {
            suma += multiplo * cuerpo.charAt(i);
            multiplo = (multiplo == 7) ? 2 : multiplo + 1;
        }

        const dvEsperado = 11 - (suma % 11);
        const dvValido = (dvEsperado == 11) ? '0' : (dvEsperado == 10) ? 'K' : dvEsperado.toString();

        if (dv === dvValido) {
            input.classList.remove('border-red-500');
            input.classList.add('border-green-500');
            document.getElementById('mensaje').textContent = "RUT aceptado";
            document.getElementById('mensaje').classList.remove('text-red-400');
            document.getElementById('mensaje').classList.add('text-green-400');
            document.getElementById('guardar').disabled = false;
        } else {
            input.classList.remove('border-green-500');
            input.classList.add('border-red-500');
            document.getElementById('mensaje').textContent = "RUT rechazado";
            document.getElementById('mensaje').classList.remove('text-green-400');
            document.getElementById('mensaje').classList.add('text-red-400');
            document.getElementById('guardar').disabled = true;
        }
    }
</script>
</body>
</html>
